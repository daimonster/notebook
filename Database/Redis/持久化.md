## 持久化
redis支持RDB和AOF两种持久化机制，持久化机制有效地避免因进程退出造成的数据丢失问题，当下次重启时利用之前持久化的文件即可实现数据恢复。

## RDB
RDB持久化是把当前进程数据生成快照保存到硬盘的进程
### 触发机制
* 手动触发：
    * save：阻塞当前redis服务器。知道RDB过程完成为止，对于内存比较打的示例会造成长时间阻塞，线上环境不建议使用
    * bgsave：Redis进程进行fork操作创建子进程，RDB持久化过程由子进程负责，完成自动结束  
    很显然bgsave是对save的哟话
* 自动触发：
    * 使用save相关配置
    * 如果从节点执行全量复制操作，主节点自动执行bgsave生成RDB文件并发送给从节点
    * 执行debug reload命令重新加载Redis时，也会自动触发save操作
    * 默认情况下执行shutdown命令时，如果没有开启AOF持久化功能则自动执行bgsave

### RDB文件处理
保存，压缩  

### 优缺点
缺点：没有办法实时持久化

## AOD
AOD（append only file）持久化：以独立日志的方式记录每次写命令，重启时再执行AOF文件中的命令来达到恢复数据的命令。AOF的主要作用时解决了数据持久化的实时性，是redis主流持久化的方式。

### 使用AOF
开启AOF功能需要设置：appendonly yes, 默认不开启，AOF文件名是通过appendfilename配置设置，默认文件名是：appendonly.aof.  
AOF的工作流程：
1. 命令写入（append）：所有的写入命令会追加到aof_buf（缓冲区）中。
1. 文件同步（sync）：AOF缓冲区根据对应的策略向硬盘做同步操作。
1. 文件重写（rewrite）：随着AOF文件越来越大，需要定期对AOF文件重写，达到压缩目的